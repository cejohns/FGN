<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Blog Posts Test</h1>
    <div id="status">Loading...</div>
    <div id="results"></div>

    <script type="module">
        const envVars = {};
        const response = await fetch('/.env');
        if (response.ok) {
            const text = await response.text();
            text.split('\n').forEach(line => {
                const [key, ...values] = line.split('=');
                if (key && values.length) {
                    envVars[key.trim()] = values.join('=').trim();
                }
            });
        }

        const SUPABASE_URL = envVars.VITE_SUPABASE_URL;
        const SUPABASE_ANON_KEY = envVars.VITE_SUPABASE_ANON_KEY;

        console.log('URL:', SUPABASE_URL);
        console.log('Key exists:', !!SUPABASE_ANON_KEY);

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.getElementById('status').textContent = 'Fetching blog posts...';

        const { data, error } = await supabase
            .from('blog_posts')
            .select('*')
            .eq('status', 'published')
            .order('published_at', { ascending: false });

        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');

        if (error) {
            statusDiv.textContent = `Error: ${error.message}`;
            statusDiv.style.color = 'red';
            console.error('Full error:', error);
        } else {
            statusDiv.textContent = `âœ… Found ${data.length} blog posts`;
            statusDiv.style.color = 'green';

            resultsDiv.innerHTML = '<h2>Blog Posts:</h2>';
            data.forEach(post => {
                const div = document.createElement('div');
                div.style.border = '1px solid #ccc';
                div.style.padding = '10px';
                div.style.margin = '10px 0';
                div.innerHTML = `
                    <h3>${post.title || 'No title'}</h3>
                    <p><strong>Author:</strong> ${post.author || 'NULL'}</p>
                    <p><strong>Category:</strong> ${post.category || 'NULL'}</p>
                    <p><strong>Post Type:</strong> ${post.post_type || 'NULL'}</p>
                    <p><strong>Featured Image:</strong> ${post.featured_image ? 'Has image' : 'NULL'}</p>
                    <p><strong>Status:</strong> ${post.status}</p>
                    <pre>${JSON.stringify(post, null, 2)}</pre>
                `;
                resultsDiv.appendChild(div);
            });
        }
    </script>
</body>
</html>
