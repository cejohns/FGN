(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3614:function(e,t,n){Promise.resolve().then(n.bind(n,9294)),Promise.resolve().then(n.t.bind(n,911,23)),Promise.resolve().then(n.t.bind(n,5660,23))},9294:function(e,t,n){"use strict";n.d(t,{default:function(){return u}});var r=n(7437),i=n(842);function u(e){let{children:t}=e;return(0,r.jsx)(i.H,{children:t})}},842:function(e,t,n){"use strict";n.d(t,{H:function(){return d},a:function(){return S}});var r,i=n(7437),u=n(2265),l=n(3053),a=n(257);function s(e){try{var t;let n=(t={},void 0===t)?void 0:t.env;if(n&&"string"==typeof n[e])return n[e]}catch(e){}try{let t=null==a?void 0:a.env;if(t&&"string"==typeof t[e])return t[e]}catch(e){}}let o=s("VITE_SUPABASE_URL")||s("NEXT_PUBLIC_SUPABASE_URL")||"",_=s("VITE_SUPABASE_ANON_KEY")||s("NEXT_PUBLIC_SUPABASE_ANON_KEY")||"";if(!o)throw Error("Missing Supabase URL. Set VITE_SUPABASE_URL (Vite) or NEXT_PUBLIC_SUPABASE_URL (Next).");if(!_)throw Error("Missing Supabase anon key. Set VITE_SUPABASE_ANON_KEY (Vite) or NEXT_PUBLIC_SUPABASE_ANON_KEY (Next).");let c=null!==(r=globalThis.__fgn_supabase__)&&void 0!==r?r:(0,l.eI)(o,_,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});globalThis.__fgn_supabase__||(globalThis.__fgn_supabase__=c,console.log("\uD83D\uDD0C Supabase client ready:",o));let f=(0,u.createContext)(null);function d(e){let{children:t}=e,[n,r]=(0,u.useState)(null),[l,a]=(0,u.useState)(null),[s,o]=(0,u.useState)(null),[_,d]=(0,u.useState)(!0),S=async e=>{try{let{data:t,error:n}=await c.from("admin_users").select("*").eq("id",e).eq("is_active",!0).maybeSingle();if(n)throw n;a(null!=t?t:null)}catch(e){console.error("Error fetching admin user:",e),a(null)}finally{d(!1)}};(0,u.useEffect)(()=>{let e=!0;(async()=>{var t;let{data:{session:n}}=await c.auth.getSession();e&&(o(n),r(null!==(t=null==n?void 0:n.user)&&void 0!==t?t:null),(null==n?void 0:n.user)?await S(n.user.id):d(!1))})();let{data:{subscription:t}}=c.auth.onAuthStateChange(async(e,t)=>{var n;o(t),r(null!==(n=null==t?void 0:t.user)&&void 0!==n?n:null),(null==t?void 0:t.user)?await S(t.user.id):(a(null),d(!1))});return()=>{e=!1,t.unsubscribe()}},[]);let h=async(e,t)=>{try{let{data:n,error:r}=await c.auth.signInWithPassword({email:e,password:t});if(r)throw r;return n.user&&await c.from("admin_users").update({last_login_at:new Date().toISOString()}).eq("id",n.user.id),{error:null}}catch(e){return console.error("Sign in failed:",e),{error:e}}},v=async()=>{await c.auth.signOut(),a(null)},E=!!(null==l?void 0:l.is_active),A=!!((null==l?void 0:l.role)==="super_admin"&&(null==l?void 0:l.is_active));return(0,i.jsx)(f.Provider,{value:{user:n,adminUser:l,session:s,loading:_,signIn:h,signOut:v,isAdmin:E,isSuperAdmin:A},children:t})}function S(){let e=(0,u.useContext)(f);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},5660:function(){},911:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[512,115,971,117,744],function(){return e(e.s=3614)}),_N_E=e.O()}]);